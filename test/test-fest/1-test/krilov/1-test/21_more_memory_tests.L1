; More memory tests
((
  ; Construct the array [1 2 3 4 5]
  
  ; Allocate the array [0 0 0 0 0]
  (rax <- (allocate 11 0))
  (rsi <- rax)
  (rsi += 4)    ; rsi stores the address of the first element in the array
  (rdi <- rsi)
  (rdi += 16)   ; rdi stores the address of the last element in the array
  
  ; Loop over each element and update it
  (rax <- 1)
  :loop1
  (cjump rax <= 5 :keep_going1 :done1)
  :keep_going1
  ; Convert into 2a+1 form
  (rbx <- rax)
  (rbx *= 2)
  (rbx += 1)
  ((mem rsi 0) <- rbx)
  (rsi += 4)
  (rax += 1)
  (goto :loop1)
  :done1
  
  ; Now loop over each element and print it
  (rsi -= 20)
  :loop2
  (cjump rsi <= rdi :keep_going2 :done2)
  
  :keep_going2
  (rax <- (mem rsi 0))
  (rax <- (print rax))
  (rsi += 4)
  (goto :loop2)
  
  :done2
))
